{"id":"d3-item-salvager-6pj","title":"test","status":"closed","priority":2,"issue_type":"task","owner":"czer323@gmail.com","created_at":"2026-01-13T15:19:18.0862119-05:00","created_by":"czer323","updated_at":"2026-01-13T15:39:21.0743131-05:00","closed_at":"2026-01-13T15:39:21.0743131-05:00"}
{"id":"d3-item-salvager-okk","title":"Fix: local DB corrupted — mixed class items in builds; remove \u0026 repopulate builds","description":"Problem: Local development DB contains corrupted build data: different class items are appended into other builds, causing test failures and unreliable imports. Default DB: d3_items.db. Importers found: python -m d3_item_salvager.scripts.import_guides and python -m d3_item_salvager.utility.load_reference_data. Note: Alembic migrations are not present in repo (migration risk).\n\n## Steps to Reproduce\n1. Run python -m d3_item_salvager.scripts.import_guides against local DB (d3_items.db).\n2. Query builds and related items using sqlite3 or a Python session and look for items attached to unexpected builds.\n3. Observe cross-class mixing: items with different class IDs attached to the same build.","design":"Backup DB; validate cleanup on a copy; recommended: drop and recreate schema using SQLModel.metadata.drop_all/create_all via Container engine; alternative: granular DELETEs in FK-safe order. Repopulate using importer scripts and add an automated script to run backup -\u003e cleanup -\u003e import.","acceptance_criteria":"## Acceptance Criteria\n- [ ] Backup file created (d3_items.db.bak) and SQL dump saved.\n- [ ] Cleanup + import executed successfully with the recommended script.\n- [ ] Builds table contains only imported builds and no cross-class mixing.\n- [ ] Integration tests pass: pytest tests/integration/test_builds_items.py","notes":"IMPLEMENTATION: Added scripts/reset_local_db.py and package entry point at src/d3_item_salvager/scripts/reset_local_db.py. Integration tests added at tests/integration/test_reset_local_db.py. Behavior: backups (.bak) and SQL dumps (.sql) are written to the provided backup directory, schema is recreated via SQLModel.metadata.drop_all/create_all, and importers are executed to repopulate the DB. TESTS: New integration tests passed locally (2 tests) — backups and SQL dump created; builds imported; referential integrity validated. No commits or pushes have been made; ready for code review before PR.","status":"in_progress","priority":1,"issue_type":"bug","owner":"czer323@gmail.com","estimated_minutes":120,"created_at":"2026-01-13T15:36:31.5075701-05:00","created_by":"czer323","updated_at":"2026-01-13T15:52:25.9996612-05:00","labels":["testing","tooling"]}
{"id":"d3-item-salvager-okk.1","title":"Implement reset \u0026 repopulation script (local dev)","description":"Create  to back up DB (copy + dump), perform safe cleanup (drop/create or granular delete), and run importers to repopulate. Must support , , , and  flags and log actions. Tests and docs required.","design":"Use Container().engine() for engine; use SQLModel.metadata.drop_all/create_all; call importers  and ; ensure script refuses to run against non-dev DBs unless explicit flag set.","acceptance_criteria":"- [ ] Script exists at  and supports flags.\n- [ ] Backup created and SQL dump saved.\n- [ ] Running script on test copy recreates schema and imports builds without cross-class mixing.\n- [ ] Integration tests added and passing.","notes":"Implemented reset script and integration tests; ran the script against local DB with confirm: backups created at backups/d3_items.db.bak and SQL dump at backups/d3_items.db.sql. Integration tests (including tests/integration/test_builds_items.py) pass locally. No commits pushed; preparing PR after your review.","status":"closed","priority":1,"issue_type":"task","owner":"czer323@gmail.com","estimated_minutes":180,"created_at":"2026-01-13T15:44:17.2263834-05:00","created_by":"czer323","updated_at":"2026-01-13T15:55:49.3291616-05:00","closed_at":"2026-01-13T15:55:49.3291616-05:00","labels":["testing","tooling"],"dependencies":[{"issue_id":"d3-item-salvager-okk.1","depends_on_id":"d3-item-salvager-okk","type":"parent-child","created_at":"2026-01-13T15:44:17.2376795-05:00","created_by":"czer323"}]}
{"id":"d3-item-salvager-ply","title":"Add DB migrations (Alembic) and migration workflow","description":"Repository currently lacks Alembic migrations; add Alembic (or compatible migration tool), generate initial migrations from current models, and add CI/automation to ensure schema migrations are applied and tested.","design":"Add Alembic to repo; configure env and alembic.ini to target development DATABASE_URL; autogenerate initial migration from SQLModel metadata; add migration test that creates a fresh DB, runs alembic upgrade head, and verifies expected tables exist; add a reset script and docs.","acceptance_criteria":"## Acceptance Criteria\n- [ ] Alembic or compatible migrations added to repo and checked into source control.\n- [ ] Running alembic upgrade head on a fresh DB produces the expected tables (matches models).\n- [ ] CI includes a migration test that runs migrations against a fresh DB and validates schema.\n- [ ] A documented reset script exists for local dev that recreates the DB and imports reference data.","notes":"Related bug: d3-item-salvager-okk; ensure migration work includes docs for local cleanup/repopulation and sample commands: sqlite3 .dump, python -m d3_item_salvager.scripts.import_guides.","status":"open","priority":2,"issue_type":"task","owner":"czer323@gmail.com","estimated_minutes":240,"created_at":"2026-01-13T15:36:53.3865052-05:00","created_by":"czer323","updated_at":"2026-01-13T15:40:52.1242902-05:00","labels":["tooling"],"dependencies":[{"issue_id":"d3-item-salvager-ply","depends_on_id":"d3-item-salvager-okk","type":"discovered-from","created_at":"2026-01-13T15:36:53.3923617-05:00","created_by":"czer323"}]}
