{"id":"d3-item-salvager-1t2","title":"Add in-memory cache and optimize /items/lookup to use master item list","description":"Avoid querying the DB on every /items/lookup call by loading the master Item list into an in-memory cache on startup or on-demand. Add an admin endpoint to reload the cache when the reference data changes.\n\n## Acceptance Criteria\n\n- Given items are loaded to cache, when /items/lookup is called repeatedly, then DB is not queried on each request and lookup latency is reduced.\n- Given the cache reload endpoint is called, then the cache is refreshed and lookups reflect newly loaded items.","design":"Load items into a thread-safe global cache on startup or lazily on first lookup; add simple metrics for cache hits/misses and an endpoint to reload; preserve API contract.","notes":"Related: d3-item-salvager-bf5, d3-item-salvager-7xk","status":"open","priority":2,"issue_type":"task","owner":"czer323@gmail.com","estimated_minutes":180,"created_at":"2026-01-13T22:00:17.6935292-05:00","created_by":"czer323","updated_at":"2026-01-13T22:00:17.6935292-05:00","labels":["ux"],"dependencies":[{"issue_id":"d3-item-salvager-1t2","depends_on_id":"d3-item-salvager-bf5","type":"blocks","created_at":"2026-01-13T22:08:03.1408853-05:00","created_by":"czer323"}]}
{"id":"d3-item-salvager-30t","title":"Add tests for slot removal and usage chips","description":"Add unit and integration tests validating slot header removal, preserved data-item-slot attribute, per-context usage chips with classes, and that slot-based filtering continues to work. Add a Playwright smoke test asserting chips have expected classes.","design":"Update tests: frontend/tests/unit/test_item_row.py to assert chips/classes and text; update frontend/tests/unit/test_table_behaviors.py or create new tests for header absence; add Playwright test to check chip classes visually.","acceptance_criteria":"Given the test suite runs, When the change is implemented, Then unit and integration tests cover the new behavior: the Slot column is absent, rows retain data-item-slot attribute, and usage chips are rendered with appropriate classes and text.\n\nGiven CI executes, When the tests run, Then CI should pass with the new tests added.","notes":"Link to UI task: d3-item-salvager-9yd","status":"open","priority":2,"issue_type":"task","owner":"czer323@gmail.com","estimated_minutes":120,"created_at":"2026-01-13T21:08:42.1672796-05:00","created_by":"czer323","updated_at":"2026-01-13T21:10:23.1821741-05:00","labels":["testing"]}
{"id":"d3-item-salvager-5hv","title":"Short-circuit item lookup when visible results exist","description":"Avoid calling /items/lookup when the current DOM contains visible rows that match the search query. Only call lookup when no visible matches exist or when slot filters hide matches.","design":"Update frontend/static/js/search.js: add hasMatchingVisibleRow(query) that only considers visible rows (aria-hidden!='true'), short-circuit the fetch when matches exist, keep debounce and current UX; update tests and Playwright scenarios.","acceptance_criteria":"Given a search term that matches at least one visible row, When typing, Then the client does not issue a network request to /items/lookup and the search status remains unchanged.\n\nGiven a search term that matches no visible rows, When typing, Then the client issues a request to /items/lookup and shows suggestion/status messages per existing behavior.\n\nGiven a search term that would match rows hidden by slot filters, When typing, Then the client treats those as non-visible and calls lookup.","notes":"Files: frontend/static/js/search.js + related tests. Related: d3-item-salvager-9yd, d3-item-salvager-30t.","status":"open","priority":2,"issue_type":"task","owner":"czer323@gmail.com","estimated_minutes":120,"created_at":"2026-01-13T21:35:21.0111565-05:00","created_by":"czer323","updated_at":"2026-01-13T21:35:21.0111565-05:00","labels":["ux"]}
{"id":"d3-item-salvager-6pj","title":"test","status":"closed","priority":2,"issue_type":"task","owner":"czer323@gmail.com","created_at":"2026-01-13T15:19:18.0862119-05:00","created_by":"czer323","updated_at":"2026-01-13T15:39:21.0743131-05:00","closed_at":"2026-01-13T15:39:21.0743131-05:00"}
{"id":"d3-item-salvager-7xk","title":"Research telemetry for items lookup frequency","description":"Research lightweight telemetry or server-side logging for /items/lookup call frequency to help measure potential optimization benefits and identify hotspots.","design":"Evaluate options: add server-side increment metric, log aggregation, or client event counter; propose minimal viable plan and estimate for full implementation.","acceptance_criteria":"Given the research completes, When reviewed, Then we have a recommended approach, tradeoffs, and an estimate for full implementation.","status":"open","priority":3,"issue_type":"task","owner":"czer323@gmail.com","estimated_minutes":60,"created_at":"2026-01-13T21:35:44.9420479-05:00","created_by":"czer323","updated_at":"2026-01-13T21:35:44.9420479-05:00","labels":["research"]}
{"id":"d3-item-salvager-860","title":"Show item name with color indicating set vs legendary in item lists","description":"Display only the item name and visually distinguish set items (green) from regular legendary items (orange). Ensure backend includes quality in item payloads and frontend adds quality-based CSS classes; hide internal IDs like P4_Unique_* from visible labels.","design":"Backend: return item.quality in nested payloads. Frontend: add sanitized class quality-{value} to item name; map set-\u003egreen, legendary-\u003eorange; update templates and components; reuse existing tokens for colors.","acceptance_criteria":"Given an item with quality set, When the item list is rendered, Then the name element has class quality-set and appears green.\n\nGiven an item with quality legendary, When the item list is rendered, Then the name element has class quality-legendary and appears orange.\n\nGiven an item name containing internal ID suffixes (e.g., P4_Unique_*), When rendered, Then the visible label only shows the human-friendly name.","notes":"Add unit tests for API and frontend template/component tests; consider a small migration/backfill if data lacks quality values.","status":"open","priority":2,"issue_type":"task","owner":"czer323@gmail.com","estimated_minutes":180,"created_at":"2026-01-13T20:47:43.3251807-05:00","created_by":"czer323","updated_at":"2026-01-13T21:10:28.6925214-05:00","labels":["ux"]}
{"id":"d3-item-salvager-9yd","title":"Remove Slot column and add colored usage chips in item lists","description":"Remove the visible Slot column from item usage tables but keep the data-item-slot attribute for filtering. Replace the per-row 'Used' badge and usage_label with per-context chips (Main, Follower, Kanai) using classes usage-main, usage-follower, usage-kanai.","design":"Update templates (frontend/templates/items/summary.html and frontend/templates/item_row.html) to render chips; update frontend/static/js/item_list.js for client-side rendering; add CSS classes in frontend/static/css/components.css and reuse accessible color tokens; ensure ARIA/accessibility.","acceptance_criteria":"Given the item usage table is rendered, When viewing rows, Then the Slot column is not visible but each row retains a data-item-slot attribute for filtering.\n\nGiven items have usage contexts, When rendered, Then each usage context is displayed as a chip with class usage-main, usage-follower or usage-kanai and readable text (Main / Follower / Kanai).\n\nGiven the item list is filtered by slot, When applying a slot filter, Then filtering still works using the preserved data-item-slot attribute.","notes":"Related issue: d3-item-salvager-860. Update unit and Playwright tests to cover behavior.","status":"open","priority":2,"issue_type":"task","owner":"czer323@gmail.com","estimated_minutes":240,"created_at":"2026-01-13T21:08:35.5531657-05:00","created_by":"czer323","updated_at":"2026-01-13T21:10:18.3362249-05:00","labels":["ux"]}
{"id":"d3-item-salvager-be1","title":"Add docs: reset DB runbook and safety instructions","description":"Document the backup -\u003e cleanup -\u003e import workflow and safety precautions (do not run on production DB). Include example commands and explain how to recover from backups. Add entry to docs/ and README.md.","design":"Add docs/reset_local_db.md with step-by-step commands; add note to README about local DB cleanup; reference the reset script at scripts/reset_local_db.py and package entrypoint.","acceptance_criteria":"- [ ] docs/reset_local_db.md added with steps and examples.\n- [ ] README updated with link to runbook and warnings.\n- [ ] Issue d3-item-salvager-okk references the docs.","notes":"Related: d3-item-salvager-okk. This is for documentation only; implementation already added as part of d3-item-salvager-okk.1.","status":"open","priority":2,"issue_type":"task","owner":"czer323@gmail.com","created_at":"2026-01-13T15:56:11.0300411-05:00","created_by":"czer323","updated_at":"2026-01-13T15:56:11.0300411-05:00"}
{"id":"d3-item-salvager-bf5","title":"Load master item list into DB from reference/data.json","description":"Load items from reference/data.json into the Item DB table with idempotent upsert behavior so repeated runs do not fail on duplicates. Ensure items like Fleshrake and Blood Brother are present.\n\n## Acceptance Criteria\n\n- Given a fresh DB, when running the reference data loader, then the Item table contains Fleshrake and Blood Brother and total items \u003e 5000.\n- Given repeated runs, then the loader is idempotent and does not raise duplicate errors.","design":"Use DataParser.get_all_items and implement upsert logic in insert_items_from_dict or add a new upsert routine. Provide a CLI flag to control loading in reset_local_db. Add unit tests for idempotency.","notes":"Related: d3-item-salvager-5hv, d3-item-salvager-7xk","status":"open","priority":2,"issue_type":"task","owner":"czer323@gmail.com","estimated_minutes":240,"created_at":"2026-01-13T22:00:06.3566108-05:00","created_by":"czer323","updated_at":"2026-01-13T22:00:06.3566108-05:00","labels":["research"]}
{"id":"d3-item-salvager-cps","title":"Add tests and docs for master item list and lookup behavior","description":"Add unit, integration, and Playwright tests that verify Fleshrake and Blood Brother are found after loading master items; add docs describing how to refresh reference data and enabling frontend master-list validation.\n\n## Acceptance Criteria\n\n- Given the master list is loaded, when running tests, then unit and Playwright tests pass that assert local validation finds 'Fleshrake'.\n- Given documentation is present, when running reset_local_db, then developers can reload the master list using documented steps.","design":"Add tests to test_data_parser and search UI Playwright tests; update scripts/reset_local_db.py and docs/01 databaseImplementation.md; add example commands.","notes":"Related: d3-item-salvager-bf5, d3-item-salvager-hbf","status":"open","priority":2,"issue_type":"task","owner":"czer323@gmail.com","estimated_minutes":180,"created_at":"2026-01-13T22:00:49.3839734-05:00","created_by":"czer323","updated_at":"2026-01-13T22:00:49.3839734-05:00","labels":["testing"],"dependencies":[{"issue_id":"d3-item-salvager-cps","depends_on_id":"d3-item-salvager-bf5","type":"blocks","created_at":"2026-01-13T22:08:30.6351559-05:00","created_by":"czer323"}]}
{"id":"d3-item-salvager-fwr","title":"Improve search ranking to prioritise exact and prefix matches over fuzzy subsequence matches","description":"Tighten search ranking so higher-probability results (exact and prefix matches) are ranked above fuzzy subsequence matches. Example: when typing 'ince', 'Incense Torch of the Grand Temple' should appear above unrelated subsequence matches.","design":"1) Audit current search implementation and scoring (client or server). 2) Implement ranking changes: boost exact and prefix matches, then token matches, then fuzzy subsequence matches. 3) Add unit tests for ranking behavior and integration/playwright test for the UI results. 4) Add optional telemetry to measure relevance improvements.","acceptance_criteria":"Given a user types a partial query such as \"ince\", When search runs, Then exact or prefix matches like \"Incense Torch of the Grand Temple\" should be ranked above other subsequence matches.\n\nGiven multiple matching items, When results are displayed, Then the top results are stable and clearly more relevant and fuzziness is only used as a fallback.","notes":"Related issues: d3-item-salvager-9yd, d3-item-salvager-860. Estimate covers research, implementation, tests, and small UI polish.","status":"open","priority":2,"issue_type":"task","owner":"czer323@gmail.com","estimated_minutes":360,"created_at":"2026-01-13T21:31:06.7394787-05:00","created_by":"czer323","updated_at":"2026-01-13T21:31:06.7394787-05:00","labels":["ux"]}
{"id":"d3-item-salvager-hbf","title":"Expose master item list to frontend for client-side validation","description":"Provide the master item name list to the frontend to allow client-side validation and autocomplete without extra backend calls. Consider embedding names in initial page render or providing a dedicated JSON endpoint (names only) with caching or lazy-load.\n\n## Acceptance Criteria\n\n- Given the page loads, when opening the search UI, then the client has the master name list and can validate 'Fleshrake' locally without calling /items/lookup.\n- Given large payload concerns, provide an opt-in config or lazy-load approach to avoid large initial page payloads.","design":"Implement endpoint or embed minimal compressed list (names/ids) and client caching; add tests (Playwright) to prove Fleshrake is validated locally; consider config to enable in prod.","notes":"Related: d3-item-salvager-bf5, d3-item-salvager-1t2","status":"open","priority":2,"issue_type":"task","owner":"czer323@gmail.com","estimated_minutes":120,"created_at":"2026-01-13T22:00:37.8157887-05:00","created_by":"czer323","updated_at":"2026-01-13T22:00:37.8157887-05:00","labels":["ux"],"dependencies":[{"issue_id":"d3-item-salvager-hbf","depends_on_id":"d3-item-salvager-bf5","type":"blocks","created_at":"2026-01-13T22:08:09.1379336-05:00","created_by":"czer323"},{"issue_id":"d3-item-salvager-hbf","depends_on_id":"d3-item-salvager-1t2","type":"blocks","created_at":"2026-01-13T22:08:16.0367677-05:00","created_by":"czer323"}]}
{"id":"d3-item-salvager-k9n","title":"Add tests asserting no lookup call when visible matches exist","description":"Add unit, integration, and Playwright tests that verify no /items/lookup network call is made when visible rows match the search query; ensure lookup is still performed when no visible matches exist.","design":"Unit: test hasMatchingVisibleRow behavior. Integration: simulate DOM and assert fetch is not called (mock). Playwright: intercept /items/lookup and assert no request is sent for visible matches, and assert request is sent when none exist.","acceptance_criteria":"Given the test suite runs, When the change is implemented, Then unit and integration tests verify the client avoids network lookup for visible matches and still calls lookup when no visible matches exist.","status":"open","priority":2,"issue_type":"task","owner":"czer323@gmail.com","estimated_minutes":180,"created_at":"2026-01-13T21:35:26.5865435-05:00","created_by":"czer323","updated_at":"2026-01-13T21:35:26.5865435-05:00","labels":["testing"]}
{"id":"d3-item-salvager-okk","title":"Fix: local DB corrupted — mixed class items in builds; remove \u0026 repopulate builds","description":"Problem: Local development DB contains corrupted build data: different class items are appended into other builds, causing test failures and unreliable imports. Default DB: d3_items.db. Importers found: python -m d3_item_salvager.scripts.import_guides and python -m d3_item_salvager.utility.load_reference_data. Note: Alembic migrations are not present in repo (migration risk).\n\n## Steps to Reproduce\n1. Run python -m d3_item_salvager.scripts.import_guides against local DB (d3_items.db).\n2. Query builds and related items using sqlite3 or a Python session and look for items attached to unexpected builds.\n3. Observe cross-class mixing: items with different class IDs attached to the same build.","design":"Backup DB; validate cleanup on a copy; recommended: drop and recreate schema using SQLModel.metadata.drop_all/create_all via Container engine; alternative: granular DELETEs in FK-safe order. Repopulate using importer scripts and add an automated script to run backup -\u003e cleanup -\u003e import.","acceptance_criteria":"## Acceptance Criteria\n- [ ] Backup file created (d3_items.db.bak) and SQL dump saved.\n- [ ] Cleanup + import executed successfully with the recommended script.\n- [ ] Builds table contains only imported builds and no cross-class mixing.\n- [ ] Integration tests pass: pytest tests/integration/test_builds_items.py","notes":"WORK COMPLETE (local): Ran reset script against local DB with confirm. Created backups/backups/d3_items.db.bak and backups/d3_items.db.sql. Recreated schema and repopulated via importers. Verified by running integration tests: tests/integration/test_builds_items.py and tests/integration/test_reset_local_db.py — all passing. No commits/pushes made. Next: prepare PR with changes and tests; will wait for your approval before committing and opening PR.","status":"in_progress","priority":1,"issue_type":"bug","owner":"czer323@gmail.com","estimated_minutes":120,"created_at":"2026-01-13T15:36:31.5075701-05:00","created_by":"czer323","updated_at":"2026-01-13T15:55:55.9405224-05:00","labels":["testing","tooling"]}
{"id":"d3-item-salvager-okk.1","title":"Implement reset \u0026 repopulation script (local dev)","description":"Create  to back up DB (copy + dump), perform safe cleanup (drop/create or granular delete), and run importers to repopulate. Must support , , , and  flags and log actions. Tests and docs required.","design":"Use Container().engine() for engine; use SQLModel.metadata.drop_all/create_all; call importers  and ; ensure script refuses to run against non-dev DBs unless explicit flag set.","acceptance_criteria":"- [ ] Script exists at  and supports flags.\n- [ ] Backup created and SQL dump saved.\n- [ ] Running script on test copy recreates schema and imports builds without cross-class mixing.\n- [ ] Integration tests added and passing.","notes":"Implemented reset script and integration tests; ran the script against local DB with confirm: backups created at backups/d3_items.db.bak and SQL dump at backups/d3_items.db.sql. Integration tests (including tests/integration/test_builds_items.py) pass locally. No commits pushed; preparing PR after your review.","status":"closed","priority":1,"issue_type":"task","owner":"czer323@gmail.com","estimated_minutes":180,"created_at":"2026-01-13T15:44:17.2263834-05:00","created_by":"czer323","updated_at":"2026-01-13T15:55:49.3291616-05:00","closed_at":"2026-01-13T15:55:49.3291616-05:00","labels":["testing","tooling"],"dependencies":[{"issue_id":"d3-item-salvager-okk.1","depends_on_id":"d3-item-salvager-okk","type":"parent-child","created_at":"2026-01-13T15:44:17.2376795-05:00","created_by":"czer323"}]}
{"id":"d3-item-salvager-ply","title":"Add DB migrations (Alembic) and migration workflow","description":"Repository currently lacks Alembic migrations; add Alembic (or compatible migration tool), generate initial migrations from current models, and add CI/automation to ensure schema migrations are applied and tested.","design":"Add Alembic to repo; configure env and alembic.ini to target development DATABASE_URL; autogenerate initial migration from SQLModel metadata; add migration test that creates a fresh DB, runs alembic upgrade head, and verifies expected tables exist; add a reset script and docs.","acceptance_criteria":"## Acceptance Criteria\n- [ ] Alembic or compatible migrations added to repo and checked into source control.\n- [ ] Running alembic upgrade head on a fresh DB produces the expected tables (matches models).\n- [ ] CI includes a migration test that runs migrations against a fresh DB and validates schema.\n- [ ] A documented reset script exists for local dev that recreates the DB and imports reference data.","notes":"Related bug: d3-item-salvager-okk; ensure migration work includes docs for local cleanup/repopulation and sample commands: sqlite3 .dump, python -m d3_item_salvager.scripts.import_guides.","status":"open","priority":2,"issue_type":"task","owner":"czer323@gmail.com","estimated_minutes":240,"created_at":"2026-01-13T15:36:53.3865052-05:00","created_by":"czer323","updated_at":"2026-01-13T15:40:52.1242902-05:00","labels":["tooling"],"dependencies":[{"issue_id":"d3-item-salvager-ply","depends_on_id":"d3-item-salvager-okk","type":"discovered-from","created_at":"2026-01-13T15:36:53.3923617-05:00","created_by":"czer323"}]}
